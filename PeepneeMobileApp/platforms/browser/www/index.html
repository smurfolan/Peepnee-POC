<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />-->

    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script type="text/javascript" src="lib/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="lib/jquery.mobile-1.4.5.min.js"></script>

    <script src="http://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.0.min.js"></script>
		<!--Only if we need to use autogenerated proxies-->
		<!--<script src="signalr/hubs"></script>-->

    <script type="text/javascript" src="js/SignalrManager.js"></script>

    <title>Hello World</title>
</head>

<body>
    <div class="app">

      <!-- Mailboxes page -->
      <div data-role="page" id="mailboxes-page"  data-url="/">

        <div data-role="header" role="banner" data-theme="b">
            <a href="#popupMenu" data-rel="popup" data-transition="slideup" class="ui-btn ui-btn-right ui-shadow ui-corner-all ui-icon-gear ui-btn-icon-right" style="height: 16px;"></a>
                <div data-role="popup" id="popupMenu" data-theme="a" class="ui-corner-all">
                    <form>
                        <div style="padding:10px 20px; width: 200px">
                            <a href="#mailboxes-page" class="ui-btn ui-btn-right ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext" style="margin: 0px;"></a>
                            <form>
                                    <h3><label for="mailbox-behaviour-switch" style="font-weight: bold;">The mailbox will open if you are unable to answer to the notification within 10 seconds</label></h3>
                                    <select name="mailbox-behaviour-switch" id="mailbox-behaviour-switch" data-role="flipswitch" data-mini="true">
                                        <option value="off">Off</option>
                                        <option selected="" value="on">On</option>
                                    </select>
                            </form>
                            <div id="default-time-container" style="margin-top: 15px">
                                <label for="set-interval-input" style="font-weight: bold;">Change the default time for opening the mailbox</label>
                                <input id="set-interval-input" type="text" value="" placeholder="Seconds" data-theme="a">
                            </div>
                            <a href="#mailboxes-page" onclick="clearInput();" id="set-default-behaviour" class="ui-btn ui-shadow ui-corner-all ui-icon-check ui-btn-icon-left " style="background: green; color:white;">Save</a>
                        </div>
                    </form>
                </div>    
            <h1 class="ui-title" role="heading">Peepnee
                
            </h1>
        </div><!-- /header -->

        <div id="accept-message-container">
            <p>You've just approved the mailbox opening.</p>
        </div>

        <div id="resend-message-container">
            <p>You've just asked for repeating the process.</p>
        </div>

        <div id="reject-message-container">
            <p>You've just rejected the mailbox opening.</p>
        </div>

        
        <div data-role="content" class="ui-content" role="main">
            <div class="user-icon"> 
                <img src="img/user-emailbox.png"></img>
            </div>   
            <div class="mailboxes-container">
                <span id="mailboxes-count"><span class="count"></span> Mailboxes</span>
                <span id="messages-count"><span class="count"></span> Messages</span>
                <br/>
                <a href="#popupAddMailbox" data-rel="popup" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a" data-transition="pop" style="background: green; color:white;">Add</a>
                <div data-role="popup" id="popupAddMailbox" data-theme="a" class="ui-corner-all">             
                    <form>
                        <div style="padding:10px 20px;">
                            <a href="#mailboxes-page" class="ui-btn ui-btn-right ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext" style="margin: 0px;"></a>
                            <h3>Please fill the following</h3>
                            <input id="add-secret-code-input" type="text" value="" placeholder="Secret Code" data-theme="a">
                            <input id="add-secret-question-input" type="text" value="" placeholder="Secret Question" data-theme="a">
                            <input id="add-secret-answer-input" type="text" value="" placeholder="Secret Answer" data-theme="a">
                            <a href="#mailboxes-page" onclick="clearInput();" id="add-mailbox-form" class="ui-btn ui-shadow ui-corner-all ui-icon-check ui-btn-icon-left " style="background: green; color:white;">Add mailbox</a>
                        </div>
                    </form>
                </div>

                <a href="#popupRentMailbox" data-rel="popup" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-action ui-btn-icon-left ui-btn-a" data-transition="pop" style="background: blue; color:white;">Rent</a>
                <div data-role="popup" id="popupRentMailbox" data-theme="a" class="ui-corner-all">
                    <form>
                        <div style="padding:10px 20px;">
                            <a href="#mailboxes-page" class="ui-btn ui-btn-right ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext" style="margin: 0px;"></a>
                            <h3>Please fill the secret code</h3>
                            <input id="rent-secret-code-input" type="text" value="" placeholder="Secret Code" data-theme="a">
                            <a href="#mailboxes-page" onclick="clearInput();" id="add-mailbox-form" class="ui-btn ui-shadow ui-corner-all ui-icon-action ui-btn-icon-left " style="background: blue; color:white;">Rent mailbox</a>
                        </div>
                    </form>
                </div>

                
            </div>
            
            <ul id="mailboxes" data-inset="true" data-role="listview" data-count-theme="b"></ul>
          </div><!-- /content -->
      </div><!-- /page -->
  
      <!-- Messages -->
      <div data-role="page" id="messages-page" data-url="/messages">
      
        <div data-role="header" role="banner" data-theme="b">
            <a href="#mailboxes-page" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left " style="display:inline-block;">Back</a>
            <a href="#popupRemoveMailbox" id="remove-mailbox-btn" data-rel="popup" data-position-to="window" class="ui-btn ui-btn-right ui-corner-all ui-shadow ui-btn-inline ui-icon-delete ui-btn-icon-left ui-btn-a" data-transition="pop" style="background: red; color:white;">Remove</a>
            <h1 class="ui-title" role="heading">Peepnee</h1>
        </div><!-- /header -->
      
        <div data-role="content" class="ui-content" role="main">
          <p style="text-align:center;">Mailbox</p>
          <p id="mailbox-address" style="text-align:center;"></p>
          
          <div data-role="popup" id="popupRemoveMailbox" data-theme="a" class="ui-corner-all">
            <form>
                <div style="padding:10px 20px;">
                    <a href="#messages-page" class="ui-btn ui-btn-right ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-notext" style="margin: 0px;"></a>
                    <h3>Please confirm removing the mailbox</h3>
                    <a href="#mailbox-address" onclick="clearInput();" id="add-mailbox-form" class="ui-btn ui-shadow ui-corner-all ui-icon-delete ui-btn-icon-left " style="background: red; color:white;">Remove mailbox</a>
                </div>
            </form>
          </div>
          <ul id="messages" data-inset="true" data-role="listview" data-count-theme="b"></ul>
        </div><!-- /content -->
      </div><!-- /page -->

      <!-- Message details -->
      <div data-role="page" id="message-details" data-url="/details">

        <div data-role="header" role="banner" data-theme="b">
            <a href="#messages-page" class="ui-btn ui-shadow ui-corner-all ui-icon-arrow-l ui-btn-icon-left" >Back</a>
            <a href="#mailboxes-page" class="ui-btn ui-shadow ui-corner-all ui-icon-home ui-btn-icon-left" >Home</a>
            <h1 class="ui-title" role="heading">Peepnee</h1>
        </div><!-- /header -->

        <div data-role="content" class="ui-content" role="main">
            <p style="text-align:center;">Message received on</p>
            <p id="message-received-on" style="text-align:center;"></p>
            <div id="message-info" style="text-align:center;"></div>
        </div><!-- /content -->
      </div><!-- /page -->

      <!-- Notification page -->
      <div data-role="page" id="notification-page" data-url="/notification">
        <a id="notification-page-link" href="#notification-page" style="display: none"></a>

        <div data-role="header" role="banner" data-theme="b">
            <h1 class="ui-title" role="heading">Peepnee</h1>
        </div><!-- /header -->

        <div data-role="content" class="ui-content" role="main">
            <p style="text-align:center;">Pending approval for opening the mailbox:</p>
            <div id=timer stile="text-align:center;"></div>
            <div id="message-image-container" style="text-align:center;">
                <img src="http://www.mailservices.emory.edu/images/OXFORD%20CAMPUS%20MAIL.png" style="width: 320px"/>
                <br/>
                <a href="#mailboxes-page" onclick="showAcceptMessage();" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a" style="background: green; color:white;">Accept</a>
                <a href="#mailboxes-page" onclick="showResendMessage();" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-recycle ui-btn-icon-left ui-btn-a" style="background: blue; color:white;">Send again</a>
                <a href="#mailboxes-page" onclick="showRejectMessage();" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-delete ui-btn-icon-left ui-btn-a" style="background: red; color:white;">Ignore</a>

            </div>
        </div><!-- /content -->

      </div><!-- /page -->

    </div>

    <script type="text/javascript" src="cordova.js"></script>
    <script>
        //document.getElementById('notification-page-link').click(); 
        //function PushNotification(nTitle, nText){
        function PushNotification(){  
            var sendTime = new Date().getTime();     
            cordova.plugins.notification.local.schedule({
                title: "You are receiving a mail",
                text: "Do you want to open the mailbox?",
                foreground: true
            });

            cordova.plugins.notification.local.on("click", function () {
                //alert("Notification");
                var now = new Date().getTime();
                if(now - sendTime <= 10000) {
                    document.getElementById('notification-page-link').click();
                    setTimer();
                } else {
                    document.getElementById('mailboxes-page').click();
                }
                //document.getElementById('notification-page-link').click();                
            });
        }

    </script>	
    <script type="text/javascript" src="js/index.js"></script>   
</body>

</html>
